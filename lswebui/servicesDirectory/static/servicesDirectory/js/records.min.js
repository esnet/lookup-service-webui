function RecordMap(e,t){this.records={};for(i=0;i<e.length;i++){var s=e[i],r=s.type[0];this.records[s["ls-host"]]?this.records[s["ls-host"]][r]?this.records[s["ls-host"]][r].push(s):this.records[s["ls-host"]][r]=[s]:(this.records[s["ls-host"]]={},this.records[s["ls-host"]][r]=[s])}if(t){for(var a=this.getHosts(),i=0;i<a.length;i++)this.mapHost(a[i]);for(var o=this.getInterfaces(),i=0;i<o.length;i++)this.mapInterface(o[i]);for(var n=this.getServices(),i=0;i<n.length;i++)this.mapService(n[i])}}function getAddresses(e){var t=[],s=e.type[0];return"host"==s?hasField(e,"host-name")&&(t=e["host-name"]):"interface"==s?hasField(e,"interface-addresses")&&(t=e["interface-addresses"]):"service"==s&&hasField(e,"service-locator")&&(t=e["service-locator"]),t}function getCommandLine(e,t){var s=[],r="";hasField(e,"service-type")&&(r=e["service-type"][0]);for(var a=getAddresses(e),i=[],o=0;o<a.length;o++)i.push(getHostFromURI(a[o]));i.sort(function(e,t){return compareHostnames(e,t)});var n="";e.host&&hasField(e.host,"pshost-toolkitversion")&&(n+=parseFloat(e.host["pshost-toolkitversion"]));for(o=0;o<i.length;o++){var c=i[o],l=getAddressType(c);if(hostnamev6.test(c)&&(l+="v6"),hasField(e,r+"-tools"))for(var d in t)$.inArray(d,e[r+"-tools"])>=0&&(t[d+n+"-"+l]?d+=n+"-"+l:t[d+n]?d+=n:t[d+"-"+l]&&(d+=v6),s.push(t[d].replace("<address>",i[o])));else t[(d="default")+n+"-"+l]?d+=n+"-"+l:t[d+n]?d+=n:t[d+"-"+l]&&(d+="-"+l),s.push(t[d].replace("<address>",i[o]))}return s}function getHostname(e){var t=e.type[0];if(hasField(e,t+"-hostname"))return e[t+"-hostname"];var s=getHostnames(e);return s[0]?s[0]:null}function getHostnames(e){var t=[],s=getAddresses(e),r=e.type[0];hasField(e,r+"-hostname")&&t.push(e[r+"-hostname"]);for(var a=0;a<s.length;a++)t.push(getHostnameFromURI(s[a]));return t=t.sort(function(e,t){return compareHostnames(e,t)}).unique()}function getLatLng(e){var t=null;if(hasField(e,"location-latitude")&&hasField(e,"location-longitude")){var s=parseFloat(e["location-latitude"][0]),r=parseFloat(e["location-longitude"][0]);isNaN(s)||isNaN(r)||(t=new google.maps.LatLng(s,r)),!t&&e.host&&(t=getLatLng(e.host))}return t}function getLatLngString(e){var t="";if(hasField(e,"location-latitude")&&hasField(e,"location-longitude")){var s=parseFloat(e["location-latitude"][0]).toFixed(4),r=parseFloat(e["location-longitude"][0]).toFixed(4);isNaN(s)||isNaN(r)||(t+="("+s+", "+r+")")}return t}function getLocationString(e){var t="";return hasField(e,"location-sitename")&&(t+=e["location-sitename"][0]+", "),hasField(e,"location-city")&&(t+=e["location-city"][0]+", "),hasField(e,"location-state")?(t+=e["location-state"][0],hasField(e,"location-code")?t+=" "+e["location-code"][0]+", ":t+=", "):hasField(e,"location-code")&&(t+=e["location-code"][0]+", "),hasField(e,"location-country")&&(t+=getCountryString(e["location-country"][0])),t.replace(/^[\s,]+|[\s,]+$/g,"")}function getMemoryString(e){var t="";if(hasField(e,"host-hardware-memory")){var s=parseSize(e["host-hardware-memory"][0]);t+=formatSize(s,2,"GB")}return t}function getNICSpeedString(e){var t="";if(hasField(e,"interface-capacity")){var s=parseRate(e["interface-capacity"][0],!0);s>=Math.pow(10,9)?t+=formatRate(s,0,"Gbit/s"):t+=formatRate(s,0,"Mbit/s")}return t}function getOSString(e){var t="";return hasField(e,"host-os-name")&&(t+=e["host-os-name"][0]+" "),hasField(e,"host-os-version")&&(t+=e["host-os-version"][0]),$.trim(t)}function getProcessorStrings(e){var t=[],s=1;hasField(e,"host-hardware-processorcount")&&(s=parseInt(e["host-hardware-processorcount"][0]));var r="";hasField(e,"host-hardware-processorspeed")&&(r+=formatSpeed(parseSpeed(e["host-hardware-processorspeed"][0]),2,"GHz")+" ");var a=0;hasField(e,"host-hardware-processorcore")&&(a=Math.ceil(parseInt(e["host-hardware-processorcore"][0])/s));var i="";if(r?i=a?1==a?r+"("+a+" core)":r+"("+a+" cores)":r:a&&(i=1==a?a+" core":a+" cores"),i)for(var o=0;o<s;o++)t.push(i);return t}function getServiceMapping(e){var t="",s="";return hasField(e,"service-type")&&(t=e["service-type"][0]),hasField(e,t+"-type")&&(s=e[t+"-type"][0]),serviceMap[t]?s&&serviceMap[t].types&&serviceMap[t].types[s]?serviceMap[t].types[s]:serviceMap[t]:null}function getServiceTypeTitle(e){var t="",s="";return hasField(e,"service-type")&&(t=e["service-type"][0]),hasField(e,t+"-type")&&(s=e[t+"-type"][0]),s?serviceMap[t]?serviceMap[t].types[s]?serviceMap[t].types[s].title:s+" "+serviceMap[t].title:s+" "+t:serviceMap[t]?serviceMap[t].title:t}function getTitle(e){if("host"==(r=e.type[0])){if(hasField(e,"location-sitename"))return e["location-sitename"][0];if(a=getHostname(e))return a}else if("interface"==r){if(hasField(e,"location-sitename"))return e["location-sitename"][0];if(a=getHostname(e))return a}else if("person"==r){if(hasField(e,"person-name"))return e["person-name"][0];if(hasField(e,"person-emails"))return e["person-emails"][0]}else if("service"==r){if(hasField(e,"location-sitename"))return e["location-sitename"][0];if(hasField(e,"service-name")){var t=e["service-name"][0],s=!1;for(var r in serviceMap)if($.inArray(t.toLowerCase(),serviceMap[r].defaults)>=0){s=!0;break}if(!s)return hasField(e,"service-type")?$.trim(t.replace(e["service-type"][0]+":","").replace(getServiceTypeTitle(e),"")):t}var a=getHostname(e);if(a)return a}else if(hasField(e,r+"-name"))return e[r+"-name"][0];return null}function hasField(e,t){return e[t]&&e[t][0]}var serviceMap={pScheduler:{title:"pScheduler Server",defaults:["pScheduler server"],custom:{title:"Example Command-Line",type:"cli",formats:{iperf3:'pscheduler task throughput --dest "<address>"',traceroute:'pscheduler task trace --dest "<address>"',ping:'pscheduler task rtt --dest "<address>"',owamp:'pscheduler task latency --dest "<address>"',iperf:'pscheduler --tool iperf throughput --dest "<address>"',nuttcp:'pscheduler --tool nuttcp throughput --dest "<address>"'}},action:"Test"},bwctl:{title:"BWCTL Server",defaults:["bwctl server"],custom:{title:"Example Command-Line",type:"cli",formats:{iperf3:'bwctl -T iperf3 -t 30 -O 4 -c "<address>"',tracepath:'bwtraceroute -T tracepath -c "<address>"',ping:'bwping -c "<address>"',iperf:'bwctl -T iperf -t 30 -i 1 -f m -c "<address>"',nuttcp:'bwctl -T nuttcp -t 30 -i 1 -f m -c "<address>"',owamp:'bwping -T owamp -N 1000 -i 0.01 -c "<address>"',traceroute:'bwtraceroute -c "<address>"',"default3.3":'bwctl -T iperf3 -t 30 -O 4 -c "<address>"',default:'bwctl -T iperf -t 20 -i 1 -f m -c "<address>"'}},action:"Test"},owamp:{title:"OWAMP Server",defaults:["owamp server"],custom:{title:"Example Command-Line",type:"cli",formats:{default:'owping -c 10000 -i 0.01 "<address>"'}},action:"Ping"},ndt:{title:"NDT Server",defaults:["ndt server"],custom:{title:"Example Command-Line",type:"cli",formats:{default:'web100clt -n "<address>" -ll'}},action:"Test"},npad:{title:"NPAD Server",defaults:["npad server"],custom:{},action:"Test"},ping:{title:"Ping Responder",defaults:["ping responder"],custom:{title:"Example Command-Line",type:"cli",formats:{"default-Hostnamev6":'ping6 "<address>"',"default-IPv6":'ping6 "<address>"',default:'ping "<address>"'}},action:"Ping"},traceroute:{title:"Traceroute Responder",defaults:["traceroute responder"],custom:{title:"Example Command-Line",type:"cli",formats:{"default-Hostnamev6":'traceroute6 "<address>"',"default-IPv6":'traceroute6 "<address>"',default:'traceroute "<address>"'}},action:"Traceroute"},ma:{title:"MA",types:{bwctl:{title:"BWCTL MA",defaults:["perfsonarbuoy ma","perfsonar-buoy ma"],custom:{title:"Access URLs",type:"ma"},action:"Query"},owamp:{title:"OWAMP MA",defaults:["perfsonarbuoy ma","perfsonar-buoy ma"],custom:{title:"Access URLs",type:"ma"},action:"Query"},traceroute:{title:"Traceroute MA",defaults:["traceroute ma"],custom:{title:"Access URLs",type:"ma"},action:"Query"}},defaults:["measurement archive","perfsonar-buoy ma","perfsonarbuoy ma","traceroute ma"],custom:{title:"Access URLs",type:"ma"},action:"Query"},"mp-bwctl":{title:"BWCTL MP",defaults:["bwctl measurement point"],custom:{title:"Access URLs",type:"mp"},action:"Query"},"mp-owamp":{title:"OWAMP MP",defaults:["owamp measurement point"],custom:{title:"Access URLs",type:"mp"},action:"Query"}};RecordMap.prototype={getRecords:function(e,t){var s=[];if(e)if(t)this.records[t["ls-host"]]&&this.records[t["ls-host"]][e]&&$.merge(s,this.records[t["ls-host"]][e]);else for(var r in this.records)this.records[r][e]&&$.merge(s,this.records[r][e]);else if(t){if(this.records[t["ls-host"]])for(var e in this.records[t["ls-host"]])$.merge(s,this.records[t["ls-host"]])}else for(var r in this.records)for(var e in this.records[r])$.merge(s,this.records[r][e]);return s},getHosts:function(e){return this.getRecords("host",e)},getInterfaces:function(e){return this.getRecords("interface",e)},getPersons:function(e){return this.getRecords("person",e)},getServices:function(e){return this.getRecords("service",e)},getAdministrators:function(e,t){t||(t=this.getPersons(e));var s=e.type[0];if(hasField(e,s+"-administrators")){for(var r=[],a=0;a<t.length;a++)$.inArray(t[a].uri,e[s+"-administrators"])>=0&&r.push(t[a]);if(r[0])return r}return null},getHost:function(e,t){t||(t=this.getHosts(e));var s=e.type[0];if("host"==s)return e;if("interface"==s){for(r=0;r<t.length;r++)if(e["ls-host"]==t[r]["ls-host"]&&hasField(t[r],"host-net-interfaces")&&$.inArray(e.uri,t[r]["host-net-interfaces"])>=0)return t[r]}else if("service"==s&&hasField(e,"service-host"))for(var r=0;r<t.length;r++)if(e["ls-host"]==t[r]["ls-host"]&&$.inArray(t[r].uri,e["service-host"])>=0)return t[r];return null},mapHost:function(e){var t=this.getAdministrators(e);if(t){for(var s=0;s<t.length;s++)t[s].hosts?t[s].hosts.push(e):t[s].hosts=[e];e.administrators=t}},mapInterface:function(e){var t=this.getHost(e);t&&(t.interfaces?t.interfaces.push(e):t.interfaces=[e],e.host=t)},mapService:function(e){var t=this.getHost(e);t&&(t.services?t.services.push(e):t.services=[e],e.host=t);var s=this.getAdministrators(e);if(s){for(var r=0;r<s.length;r++)s[r].services?s[r].services.push(e):s[r].services=[e];e.administrators=s}}};
