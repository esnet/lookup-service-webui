function RecordMap(e,t){this.records={};for(var r=0;r<e.length;r++){var s=e[r],a=s.type[0];this.records[s["ls-host"]]?this.records[s["ls-host"]][a]?this.records[s["ls-host"]][a].push(s):this.records[s["ls-host"]][a]=[s]:(this.records[s["ls-host"]]={},this.records[s["ls-host"]][a]=[s])}if(t){for(var i=this.getHosts(),r=0;r<i.length;r++)this.mapHost(i[r]);for(var o=this.getInterfaces(),r=0;r<o.length;r++)this.mapInterface(o[r]);for(var n=this.getServices(),r=0;r<n.length;r++)this.mapService(n[r])}}function getAddresses(e){var t=[],r=e.type[0];return"host"==r?hasField(e,"host-name")&&(t=e["host-name"]):"interface"==r?hasField(e,"interface-addresses")&&(t=e["interface-addresses"]):"service"==r&&hasField(e,"service-locator")&&(t=e["service-locator"]),t}function getCommandLine(e,t){var r=[],s="";hasField(e,"service-type")&&(s=e["service-type"][0]);for(var a=getAddresses(e),i=[],o=0;o<a.length;o++)i.push(getHostFromURI(a[o]));i.sort(function(e,t){return compareHostnames(e,t)});var n="";e.host&&hasField(e.host,"pshost-toolkitversion")&&(n+=parseFloat(e.host["pshost-toolkitversion"]));for(var o=0;o<i.length;o++){var c=i[o],l=getAddressType(c);if(hostnamev6.test(c)&&(l+="v6"),hasField(e,s+"-tools"))for(var d in t)$.inArray(d,e[s+"-tools"])>=0&&(t[d+n+"-"+l]?d+=n+"-"+l:t[d+n]?d+=n:t[d+"-"+l]&&(d+=v6),r.push(t[d].replace("<address>",i[o])));else{var d="default";t[d+n+"-"+l]?d+=n+"-"+l:t[d+n]?d+=n:t[d+"-"+l]&&(d+="-"+l),r.push(t[d].replace("<address>",i[o]))}}return r}function getHostname(e){var t=e.type[0];if(hasField(e,t+"-hostname"))return e[t+"-hostname"];var r=getHostnames(e);return r[0]?r[0]:null}function getHostnames(e){var t=[],r=getAddresses(e),s=e.type[0];hasField(e,s+"-hostname")&&t.push(e[s+"-hostname"]);for(var a=0;a<r.length;a++)t.push(getHostnameFromURI(r[a]));return t=t.sort(function(e,t){return compareHostnames(e,t)}).unique()}function getLatLng(e){var t=null;if(hasField(e,"location-latitude")&&hasField(e,"location-longitude")){var r=parseFloat(e["location-latitude"][0]),s=parseFloat(e["location-longitude"][0]);t=new google.maps.LatLng(r,s),t.lat()&&t.lng()||(t=null),e.host&&(t=getLatLng(e.host))}return t}function getLatLngString(e){var t="";if(hasField(e,"location-latitude")&&hasField(e,"location-longitude")){var r=parseFloat(e["location-latitude"][0]).toFixed(4),s=parseFloat(e["location-longitude"][0]).toFixed(4);t+="("+r+", "+s+")"}return t}function getLocationString(e){var t="";return hasField(e,"location-sitename")&&(t+=e["location-sitename"][0]+", "),hasField(e,"location-city")&&(t+=e["location-city"][0]+", "),hasField(e,"location-state")?(t+=e["location-state"][0],t+=hasField(e,"location-code")?" "+e["location-code"][0]+", ":", "):hasField(e,"location-code")&&(t+=e["location-code"][0]+", "),hasField(e,"location-country")&&(t+=getCountryString(e["location-country"][0])),t.replace(/^[\s,]+|[\s,]+$/g,"")}function getMemoryString(e){var t="";if(hasField(e,"host-hardware-memory")){var r=parseSize(e["host-hardware-memory"][0]);t+=formatSize(r,2,"GB")}return t}function getNICSpeedString(e){var t="";if(hasField(e,"interface-capacity")){var r=parseRate(e["interface-capacity"][0],!0);t+=r>=Math.pow(10,9)?formatRate(r,0,"Gbit/s"):formatRate(r,0,"Mbit/s")}return t}function getOSString(e){var t="";return hasField(e,"host-os-name")&&(t+=e["host-os-name"][0]+" "),hasField(e,"host-os-version")&&(t+=e["host-os-version"][0]),$.trim(t)}function getProcessorStrings(e){var t=[],r=1;hasField(e,"host-hardware-processorcount")&&(r=parseInt(e["host-hardware-processorcount"][0]));var s="";hasField(e,"host-hardware-processorspeed")&&(s+=formatSpeed(parseSpeed(e["host-hardware-processorspeed"][0]),2,"GHz")+" ");var a=0;hasField(e,"host-hardware-processorcore")&&(a=Math.ceil(parseInt(e["host-hardware-processorcore"][0])/r));var i="";if(s?i=a?1==a?s+"("+a+" core)":s+"("+a+" cores)":s:a&&(i=1==a?a+" core":a+" cores"),i)for(var o=0;r>o;o++)t.push(i);return t}function getServiceMapping(e){var t="",r="";return hasField(e,"service-type")&&(t=e["service-type"][0]),hasField(e,t+"-type")&&(r=e[t+"-type"][0]),serviceMap[t]?r&&serviceMap[t].types&&serviceMap[t].types[r]?serviceMap[t].types[r]:serviceMap[t]:null}function getServiceTypeTitle(e){var t="",r="";return hasField(e,"service-type")&&(t=e["service-type"][0]),hasField(e,t+"-type")&&(r=e[t+"-type"][0]),r?serviceMap[t]?serviceMap[t].types[r]?serviceMap[t].types[r].title:r+" "+serviceMap[t].title:r+" "+t:serviceMap[t]?serviceMap[t].title:t}function getTitle(e){var t=e.type[0];if("host"==t){if(hasField(e,"location-sitename"))return e["location-sitename"][0];if(r=getHostname(e))return r}else if("interface"==t){if(hasField(e,"location-sitename"))return e["location-sitename"][0];var r=getHostname(e);if(r)return r}else if("person"==t){if(hasField(e,"person-name"))return e["person-name"][0];if(hasField(e,"person-emails"))return e["person-emails"][0]}else if("service"==t){if(hasField(e,"location-sitename"))return e["location-sitename"][0];if(hasField(e,"service-name")){var s=e["service-name"][0],a=!1;for(var t in serviceMap)if($.inArray(s.toLowerCase(),serviceMap[t].defaults)>=0){a=!0;break}if(!a)return hasField(e,"service-type")?$.trim(s.replace(e["service-type"][0]+":","").replace(getServiceTypeTitle(e),"")):s}var r=getHostname(e);if(r)return r}else if(hasField(e,t+"-name"))return e[t+"-name"][0];return null}function hasField(e,t){return e[t]&&e[t][0]}var serviceMap={bwctl:{title:"BWCTL Server",defaults:["bwctl server"],custom:{title:"Example Command-Line",type:"cli",formats:{iperf3:'bwctl -T iperf3 -t 30 -O 4 -c "<address>"',tracepath:'bwtraceroute -T tracepath -c "<address>"',ping:'bwping -c "<address>"',iperf:'bwctl -T iperf -t 30 -i 1 -f m -c "<address>"',nuttcp:'bwctl -T nuttcp -t 30 -i 1 -f m -c "<address>"',owamp:'bwping -T owamp -N 1000 -i 0.01 -c "<address>"',traceroute:'bwtraceroute -c "<address>"',"default3.3":'bwctl -T iperf3 -t 30 -O 4 -c "<address>"',"default":'bwctl -T iperf -t 20 -i 1 -f m -c "<address>"'}},action:"Test"},owamp:{title:"OWAMP Server",defaults:["owamp server"],custom:{title:"Example Command-Line",type:"cli",formats:{"default":'owping -c 10000 -i 0.01 "<address>"'}},action:"Ping"},ndt:{title:"NDT Server",defaults:["ndt server"],custom:{title:"Example Command-Line",type:"cli",formats:{"default":'web100clt -n "<address>" -ll'}},action:"Test"},npad:{title:"NPAD Server",defaults:["npad server"],custom:{},action:"Test"},ping:{title:"Ping Responder",defaults:["ping responder"],custom:{title:"Example Command-Line",type:"cli",formats:{"default-Hostnamev6":'ping6 "<address>"',"default-IPv6":'ping6 "<address>"',"default":'ping "<address>"'}},action:"Ping"},traceroute:{title:"Traceroute Responder",defaults:["traceroute responder"],custom:{title:"Example Command-Line",type:"cli",formats:{"default-Hostnamev6":'traceroute6 "<address>"',"default-IPv6":'traceroute6 "<address>"',"default":'traceroute "<address>"'}},action:"Traceroute"},ma:{title:"MA",types:{bwctl:{title:"BWCTL MA",defaults:["perfsonarbuoy ma","perfsonar-buoy ma"],custom:{title:"Access URLs",type:"ma"},action:"Query"},owamp:{title:"OWAMP MA",defaults:["perfsonarbuoy ma","perfsonar-buoy ma"],custom:{title:"Access URLs",type:"ma"},action:"Query"},traceroute:{title:"Traceroute MA",defaults:["traceroute ma"],custom:{title:"Access URLs",type:"ma"},action:"Query"}},defaults:["measurement archive","perfsonar-buoy ma","perfsonarbuoy ma","traceroute ma"],custom:{title:"Access URLs",type:"ma"},action:"Query"}};RecordMap.prototype={getRecords:function(e,t){var r=[];if(e)if(t)this.records[t["ls-host"]]&&this.records[t["ls-host"]][e]&&$.merge(r,this.records[t["ls-host"]][e]);else for(var s in this.records)this.records[s][e]&&$.merge(r,this.records[s][e]);else if(t){if(this.records[t["ls-host"]])for(var e in this.records[t["ls-host"]])$.merge(r,this.records[t["ls-host"]])}else for(var s in this.records)for(var e in this.records[s])$.merge(r,this.records[s][e]);return r},getHosts:function(e){return this.getRecords("host",e)},getInterfaces:function(e){return this.getRecords("interface",e)},getPersons:function(e){return this.getRecords("person",e)},getServices:function(e){return this.getRecords("service",e)},getAdministrators:function(e,t){t||(t=this.getPersons(e));var r=e.type[0];if(hasField(e,r+"-administrators")){for(var s=[],a=0;a<t.length;a++)$.inArray(t[a].uri,e[r+"-administrators"])>=0&&s.push(t[a]);if(s[0])return s}return null},getHost:function(e,t){t||(t=this.getHosts(e));var r=e.type[0];if("host"==r)return e;if("interface"==r){for(var s=0;s<t.length;s++)if(e["ls-host"]==t[s]["ls-host"]&&hasField(t[s],"host-net-interfaces")&&$.inArray(e.uri,t[s]["host-net-interfaces"])>=0)return t[s]}else if("service"==r&&hasField(e,"service-host"))for(var s=0;s<t.length;s++)if(e["ls-host"]==t[s]["ls-host"]&&$.inArray(t[s].uri,e["service-host"])>=0)return t[s];return null},mapHost:function(e){var t=this.getAdministrators(e);if(t){for(var r=0;r<t.length;r++)t[r].hosts?t[r].hosts.push(e):t[r].hosts=[e];e.administrators=t}},mapInterface:function(e){var t=this.getHost(e);t&&(t.interfaces?t.interfaces.push(e):t.interfaces=[e],e.host=t)},mapService:function(e){var t=this.getHost(e);t&&(t.services?t.services.push(e):t.services=[e],e.host=t);var r=this.getAdministrators(e);if(r){for(var s=0;s<r.length;s++)r[s].services?r[s].services.push(e):r[s].services=[e];e.administrators=r}}};